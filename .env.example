# ===========================================
# CONFIGURAÇÃO DO AMBIENTE
# ===========================================

# Ambiente de execução (development, production)
NODE_ENV=development

# ===========================================
# BANCO DE DADOS
# ===========================================

# URL de conexão do PostgreSQL
# Formato: postgresql://usuario:senha@host:porta/database
DATABASE_URL=postgresql://user:password@localhost:5432/dental_clinic

# ===========================================
# REDIS (SESSÕES E CACHE)
# ===========================================

# Host do Redis (obrigatório para produção)
REDIS_HOST=localhost

# Porta do Redis
REDIS_PORT=6379

# Senha do Redis (se configurada)
# REDIS_PASSWORD=sua-senha-redis

# Modo cluster do Redis (opcional)
# REDIS_CLUSTER_NODES=host1:port1,host2:port2,host3:port3

# ===========================================
# SESSÕES E SEGURANÇA
# ===========================================

# Secret para assinar cookies de sessão
# CRÍTICO: Gerar um secret aleatório e forte para produção!
# Comando para gerar: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
SESSION_SECRET=change-this-to-a-random-secret-in-production

# Duração da sessão em milissegundos (padrão: 24 horas)
# SESSION_MAX_AGE=86400000

# ===========================================
# AUTENTICAÇÃO GOOGLE OAuth
# ===========================================

# Credenciais do Google OAuth (opcional)
# Obter em: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=seu-google-client-id.apps.googleusercontent.com
# GOOGLE_CLIENT_SECRET=seu-google-client-secret

# URL de callback do Google OAuth
# GOOGLE_CALLBACK_URL=http://localhost:5000/api/auth/google/callback

# ===========================================
# EMAIL / SMTP (OBRIGATÓRIO para SaaS)
# ===========================================

# Configurações de email SMTP
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=seu-email@gmail.com
SMTP_PASS=sua-senha-app-gmail
EMAIL_FROM=DentalSystem <noreply@dentalsystem.com>

# Alternativas de SMTP:
# Office 365:
# SMTP_HOST=smtp.office365.com
# SMTP_PORT=587
# SMTP_SECURE=false

# SendGrid:
# SMTP_HOST=smtp.sendgrid.net
# SMTP_PORT=587
# SMTP_USER=apikey
# SMTP_PASS=SG.xxxxxxxxxxxx

# Amazon SES:
# SMTP_HOST=email-smtp.us-east-1.amazonaws.com
# SMTP_PORT=587

# ===========================================
# STRIPE - Cartão de Crédito Internacional
# ===========================================

# Stripe API Keys
# Obter em: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_YOUR_STRIPE_SECRET_KEY_HERE
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET_HERE

# Para produção (trocar keys acima):
# STRIPE_SECRET_KEY=sk_live_YOUR_STRIPE_LIVE_KEY_HERE
# STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET_HERE

# Webhook URL: https://seu-dominio.com/api/webhooks/stripe

# ===========================================
# NOWPAYMENTS - Criptomoedas
# ===========================================

# NOWPayments API
# Obter em: https://account.nowpayments.io/settings/api-keys
NOWPAYMENTS_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxx
NOWPAYMENTS_IPN_SECRET=sua_senha_secreta_123

# Webhook URL (IPN): https://seu-dominio.com/api/webhooks/nowpayments
# Suporta: Bitcoin, Ethereum, USDT, BNB, Litecoin, e 300+ outras

# ===========================================
# MERCADOPAGO - Pix, Boleto, Cartão (Brasil)
# ===========================================

# MercadoPago Access Token
# Obter em: https://www.mercadopago.com.br/settings/account/credentials
MERCADOPAGO_ACCESS_TOKEN=APP_USR-xxxxxxxxxxxxxxxxxxxxxxxx
MERCADOPAGO_WEBHOOK_SECRET=sua_senha_webhook_123

# Para testes (trocar token acima):
# MERCADOPAGO_ACCESS_TOKEN=TEST-xxxxxxxxxxxxxxxxxxxxxxxx

# Webhook URL: https://seu-dominio.com/api/webhooks/mercadopago

# ===========================================
# ARMAZENAMENTO DE ARQUIVOS (S3/MINIO)
# ===========================================

# Diretório local para uploads (fallback quando S3 não está configurado)
# UPLOAD_DIR=./uploads

# ===========================================
# MINIO / S3 STORAGE (RECOMENDADO PARA PRODUÇÃO)
# ===========================================

# MinIO endpoint (ou AWS S3 endpoint)
# Para MinIO: https://minio.seudominio.com
# Para AWS S3: https://s3.amazonaws.com
S3_ENDPOINT=https://odontobot-minio.pbzgje.easypanel.host

# Credenciais de acesso
S3_ACCESS_KEY_ID=sua-access-key-aqui
S3_SECRET_ACCESS_KEY=sua-secret-key-aqui

# Bucket para armazenamento
S3_BUCKET=digital

# Região (padrão: us-east-1, para MinIO qualquer valor funciona)
S3_REGION=us-east-1

# Alternativa: AWS S3 tradicional (sem MinIO)
# AWS_ACCESS_KEY_ID=sua-access-key
# AWS_SECRET_ACCESS_KEY=sua-secret-key
# AWS_REGION=us-east-1
# S3_BUCKET=dental-clinic-files

# ===========================================
# LOGS E MONITORAMENTO
# ===========================================

# Nível de log (debug, info, warn, error)
LOG_LEVEL=info

# Sentry DSN para tracking de erros (opcional)
# SENTRY_DSN=https://...@sentry.io/...

# ===========================================
# ESCALONAMENTO VERTICAL (PERFORMANCE)
# ===========================================

# ---- POOL DE CONEXÕES POSTGRESQL ----
# Conexões máximas simultâneas (padrão: 100 em prod, 10 em dev)
# Aumentar para servidores com mais RAM (cada conexão ~5-10MB)
# DB_POOL_MAX=100

# Conexões mínimas mantidas (padrão: 10 em prod, 2 em dev)
# DB_POOL_MIN=10

# Timeout para conexão ociosa em ms (padrão: 30000)
# DB_IDLE_TIMEOUT=30000

# Timeout para obter conexão em ms (padrão: 10000)
# DB_CONNECTION_TIMEOUT=10000

# ---- WORKERS (MULTI-CORE) ----
# Número de workers do cluster (padrão: CPUs disponíveis, max 16)
# Em servidor de 8 cores, use 8. Em 32 cores, use 16 (limite)
# MAX_WORKERS=8

# ---- REDIS POOL ----
# Máximo de conexões Redis (padrão: 10)
# REDIS_POOL_MAX=10

# ---- FILAS DE PROCESSAMENTO (BullMQ) ----
# Concorrência do worker de WhatsApp (padrão: 3)
# QUEUE_WHATSAPP_CONCURRENCY=3

# Concorrência do worker de Email (padrão: 5)
# QUEUE_EMAIL_CONCURRENCY=5

# Concorrência do worker de Automações (padrão: 2)
# QUEUE_AUTOMATIONS_CONCURRENCY=2

# Concorrência do worker de Relatórios (padrão: 1)
# QUEUE_REPORTS_CONCURRENCY=1

# ===========================================
# RATE LIMITING
# ===========================================

# Janela de rate limiting em ms (padrão: 900000 = 15 min)
# RATE_LIMIT_WINDOW_MS=900000

# Máximo de requisições por janela por IP (padrão: 500)
# Aumentar para APIs com alto tráfego legítimo
# RATE_LIMIT_MAX=500

# ===========================================
# CACHE
# ===========================================

# Tamanho máximo do cache em memória (número de itens)
# CACHE_MAX_ITEMS=10000

# TTL padrão do cache em segundos (padrão: 300 = 5 min)
# CACHE_DEFAULT_TTL=300

# ===========================================
# SERVIDOR
# ===========================================

# Porta do servidor (padrão: 5000)
PORT=5000

# Host do servidor (padrão: 0.0.0.0 = aceita de qualquer IP)
# HOST=0.0.0.0

# Tamanho máximo do body JSON em MB (padrão: 10)
# MAX_BODY_SIZE_MB=10

# ===========================================
# N8N - AUTOMAÇÕES
# ===========================================

# URL base dos webhooks do n8n (obrigatório para automações)
# N8N_WEBHOOK_BASE_URL=https://n8n.seusiteaqui.com
N8N_WEBHOOK_BASE_URL=http://localhost:5678

# Secret para validar webhooks do n8n (gerar aleatório)
# Comando para gerar: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
N8N_WEBHOOK_SECRET=change-this-to-a-random-secret

# API Key do n8n (para criar workflows programaticamente)
# N8N_API_KEY=n8n_api_xxxxx

# ===========================================
# SAAS MULTI-TENANT (N8N)
# ===========================================

# API Key Master para workflows N8N multi-tenant
# Esta chave permite que UM ÚNICO workflow processe TODAS as empresas
# Gerar com: node -e "console.log('saas_' + require('crypto').randomBytes(32).toString('hex'))"
SAAS_MASTER_API_KEY=saas_change_this_to_a_secure_random_key

# IMPORTANTE: Configure esta variável no N8N também!
# No N8N: Settings > Variables > Adicionar:
#   - SAAS_API_URL: URL do seu SaaS (ex: https://seu-saas.com ou http://localhost:5000)
#   - Criar credencial "SaaS Master API Key" do tipo HTTP Header Auth:
#     - Header Name: X-API-Key
#     - Header Value: <valor de SAAS_MASTER_API_KEY>

# ===========================================
# WUZAPI 3.0 - WHATSAPP API (SAAS COMPARTILHADO)
# ===========================================

# URL base do Wuzapi compartilhado (INSTÂNCIA VPS)
# Esta instância é usada por TODAS as empresas do SaaS
# Cada empresa configura seu próprio token nas settings
WUZAPI_BASE_URL=https://private-wuzapi.pbzgje.easypanel.host

# Token Admin do Wuzapi (opcional - usado no onboarding automático)
# Este token é atribuído às empresas durante o onboarding
# Para múltiplos tokens, cada empresa precisa gerar o seu
WUZAPI_ADMIN_TOKEN=fOMKUgbYd5ga1rGFn8xLygSPcmHzdEo4

# URL pública do sistema (para webhooks)
# IMPORTANTE: Deve ser acessível publicamente para o Wuzapi enviar webhooks
# Em dev local, use ngrok ou similar
BASE_URL=http://localhost:5000

# Para produção:
# BASE_URL=https://seu-sistema.com.br

# HMAC Key global para validar webhooks do Wuzapi
# IMPORTANTE: Copie o valor de WUZAPI_GLOBAL_HMAC_KEY do seu Wuzapi
# Isso garante que webhooks são autênticos
WUZAPI_GLOBAL_HMAC_KEY=kNdcuZvLkU9I9WvYAT8gIUvjpClg8MVP

# Webhook secret alternativo (fallback)
# WUZAPI_WEBHOOK_SECRET=seu-webhook-secret

# ===========================================
# GOOGLE CALENDAR
# ===========================================

# Credenciais para integração Google Calendar
# Obter em: https://console.cloud.google.com/apis/credentials
# 1. Criar projeto ou selecionar existente
# 2. Ativar Google Calendar API
# 3. Criar credenciais OAuth 2.0
# 4. Adicionar redirect URI autorizada (ver abaixo)
# 5. Copiar Client ID e Client Secret

GOOGLE_CLIENT_ID=seu-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-seu-client-secret
GOOGLE_REDIRECT_URI=http://localhost:5000/api/v1/google/callback

# Para produção, use HTTPS:
# GOOGLE_REDIRECT_URI=https://seusite.com/api/v1/google/callback

# ===========================================
# IMPORTAÇÃO DE PACIENTES (OCR + AI)
# ===========================================

# DeepSeek API Key (RECOMENDADO - 95% mais barato que OpenAI!)
# Obter em: https://platform.deepseek.com/
# Custo: ~R$ 0,30 por 1.000 fichas processadas
# Deixe vazio para usar OpenAI como fallback
DEEPSEEK_API_KEY=sk-...

# OpenAI API Key (FALLBACK - usado apenas se DEEPSEEK_API_KEY estiver vazio)
# Obter em: https://platform.openai.com/api-keys
# Custo: ~R$ 1,50 por 1.000 fichas (5x mais caro que DeepSeek)
# OPENAI_API_KEY=sk-...

# Google Cloud Vision API (para OCR de fichas físicas)
# Caminho para o arquivo JSON de credenciais do Service Account
# Obter em: https://console.cloud.google.com/apis/credentials
# 1. Criar Service Account com role "Cloud Vision API User"
# 2. Baixar arquivo JSON das credenciais
# 3. Colocar o caminho completo abaixo
# IMPORTANTE: Path relativo ou absoluto
GOOGLE_APPLICATION_CREDENTIALS=./config/google-vision-credentials.json

# Preço de cobrança da digitalização (R$ 30,00 por 1.000 fichas)
# Esse é o preço que você cobra dos clientes (custo da API + margem)
# DIGITALIZATION_PRICE_PER_THOUSAND=3000

# ===========================================
# RECURSOS OPCIONAIS
# ===========================================

# SMS Gateway (opcional - fallback do WhatsApp)
# SMS_API_KEY=...
# SMS_FROM=DentalClinic

# Backup automático (opcional)
# BACKUP_ENABLED=true
# BACKUP_SCHEDULE=0 2 * * *  # Cron: todo dia às 2h
# BACKUP_RETENTION_DAYS=30

# ===========================================
# DESENVOLVIMENTO
# ===========================================

# Habilitar debug do Drizzle ORM
# DEBUG=drizzle:*

# Habilitar hot reload (desenvolvimento)
# HOT_RELOAD=true

# ===========================================
# NOTAS IMPORTANTES
# ===========================================

# 1. NUNCA commite o arquivo .env no Git!
# 2. Use .env.example como template
# 3. Em produção, SEMPRE configure SESSION_SECRET único
# 4. Para produção, configure Redis obrigatoriamente
# 5. Use HTTPS em produção (configure reverse proxy nginx/traefik)
# 6. Habilite SSL no banco de dados em produção
# 7. Configure backups regulares do banco de dados
# 8. Monitore os health checks: /health, /health/ready, /health/live
